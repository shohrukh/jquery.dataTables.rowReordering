(function(e){e.fn.rowReordering=function(t){function n(){f.fnSettings().oFeatures.bProcessing&&e(".dataTables_processing").css("visibility","visible")}function r(){f.fnSettings().oFeatures.bProcessing&&e(".dataTables_processing").css("visibility","hidden")}function i(t){var n=1e6;return e(t,f).each(function(){iPosition=parseInt(f.fnGetData(this,c.iIndexColumn)),iPosition<n&&(n=iPosition)}),n}function s(e,t,n,r){e.sortable("cancel"),n<=t.iLogLevel&&(r!=undefined?t.fnAlert(r,""):t.fnAlert("Row cannot be moved","")),t.fnEndProcessingMode()}function o(t,n){var r=e("#"+n),i=f.fnGetData(r[0],c.iIndexColumn),s=-1,o,u=r.prev(t);if(u.length>0)s=parseInt(f.fnGetData(u[0],c.iIndexColumn)),s<i&&(s+=1);else{var a=r.next(t);a.length>0&&(s=parseInt(f.fnGetData(a[0],c.iIndexColumn)),s>i&&(s-=1))}return s<i?o="back":o="forward",{sDirection:o,iCurrentPosition:i,iNewPosition:s}}function u(t,n,r,i,s,o){var u=n,a=r;i=="back"&&(u=r,a=n),e(f.fnGetNodes()).each(function(){if(o!=""&&e(this).attr("data-group")!=o)return;var t=this,n=parseInt(f.fnGetData(t,c.iIndexColumn));u<=n&&n<=a&&(t.id==s?f.fnUpdate(r,f.fnGetPosition(t),c.iIndexColumn,!1):i=="back"?f.fnUpdate(n+1,f.fnGetPosition(t),c.iIndexColumn,!1):f.fnUpdate(n-1,f.fnGetPosition(t),c.iIndexColumn,!1))});var l=f.fnSettings();if(l.oFeatures.bServerSide===!1){var h=l._iDisplayStart;l.oApi._fnReDraw(l),l._iDisplayStart=h,l.oApi._fnCalculateEnd(l)}l.oApi._fnDraw(l)}function a(e,t){alert(e)}var f=this,l={iIndexColumn:0,iStartPosition:1,sURL:null,sRequestType:"POST",iGroupingLevel:0,fnAlert:a,iLogLevel:1,sDataGroupAttribute:"data-group",fnStartProcessingMode:n,fnEndProcessingMode:r},c=e.extend(l,t),h,p;return this.each(function(){var t=f.fnSettings().aaSortingFixed==null?new Array:f.fnSettings().aaSortingFixed;t.push([c.iIndexColumn,"asc"]),f.fnSettings().aaSortingFixed=t;for(var n=0;n<f.fnSettings().aoColumns.length;n++)f.fnSettings().aoColumns[n].bSortable=!1;f.fnDraw(),e("tbody",f).sortable({cursor:"move",update:function(t,n){var r=e(this),i="tbody tr",a="";if(c.bGroupingUsed){a=e(n.item).attr(c.sDataGroupAttribute);if(a==null||a==undefined){s(r,c,3,"Grouping row cannot be moved");return}i="tbody tr["+c.sDataGroupAttribute+" ='"+a+"']"}var f=o(i,n.item.context.id);if(f.iNewPosition==-1){s(r,c,2);return}c.sURL!=null?(c.fnStartProcessingMode(),e.ajax({url:c.sURL,type:c.sRequestType,data:{id:n.item.context.id,fromPosition:f.iCurrentPosition,toPosition:f.iNewPosition,direction:f.sDirection,group:a},success:function(){u(i,f.iCurrentPosition,f.iNewPosition,f.sDirection,n.item.context.id,a),c.fnEndProcessingMode()},error:function(e){s(r,c,1,e.statusText)}})):u(i,f.iCurrentPosition,f.iNewPosition,f.sDirection,n.item.context.id,a)}})})}})(jQuery);